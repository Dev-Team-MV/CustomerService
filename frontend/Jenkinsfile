// Job independiente: solo frontend. En Jenkins â†’ Script Path: frontend/Jenkinsfile
// No requiere plugin Node.js: instala Node en el workspace con nvm. Requiere: curl, bash. Docker en el agente para Build Docker Image.
pipeline {
  agent any

  options {
    timeout(time: 15, unit: 'MINUTES')
  }

  environment {
    IMAGE_NAME = "customer-service-frontend"
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Install & Build') {
      steps {
        dir('frontend') {
          sh '''#!/bin/bash
            set -e
            export NVM_DIR="${WORKSPACE}/.nvm"
            curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
            [ -s "$NVM_DIR/nvm.sh" ] && \\. "$NVM_DIR/nvm.sh"
            nvm install 20
            nvm use 20
            npm ci
            npm run build
          '''
        }
      }
    }

    stage('Build Docker Image') {
      steps {
        dir('frontend') {
          script {
            docker.build(env.IMAGE_NAME)
          }
        }
      }
    }
  }

  post {
    always {
      cleanWs()
    }
  }
}
